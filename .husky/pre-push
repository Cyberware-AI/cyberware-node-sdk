#!/usr/bin/env sh

echo "Running pre-push checks..."

# Ensure formatting is clean (no changes needed)
bun run format:check
if [ $? -ne 0 ]; then
  echo "Prettier check failed. Please run 'bun run format:all' and commit the changes."
  exit 1
fi

# Lint
bun run lint
if [ $? -ne 0 ]; then
  echo "Linting failed. Please fix lint errors before pushing."
  exit 1
fi

# Tests
bun test
if [ $? -ne 0 ]; then
  echo "Tests failed. Please fix tests before pushing."
  exit 1
fi

echo "Pre-push checks passed."

# Auto-increment version before push
echo "Auto-incrementing version..."
CURRENT_VERSION=$(node -p "require('./package.json').version")
echo "Current version: $CURRENT_VERSION"

# Increment patch version
bun version patch --no-git-tag-version

NEW_VERSION=$(node -p "require('./package.json').version")
echo "New version: $NEW_VERSION"

# Add the version change to the current push
git add package.json
git commit --amend --no-edit

echo "Version incremented to $NEW_VERSION and included in push."
exit 0


